# حل مشكلة الاتصال بقاعدة البيانات

## المشكلة
```
Can't reach database server at `localhost:3306`
Invalid `prisma.trafficData.findMany()` invocation
```

## الحلول

### الحل 1: التحقق من حالة MySQL

#### Windows (XAMPP/WAMP/MySQL Server)
1. افتح **Services** (الخدمات):
   - اضغط `Win + R`
   - اكتب `services.msc` واضغط Enter
2. ابحث عن **MySQL** في القائمة
3. تأكد من أن الحالة هي **Running** (قيد التشغيل)
4. إذا لم تكن قيد التشغيل:
   - اضغط كليك يمين → **Start**

#### أو استخدم PowerShell:
```powershell
# التحقق من حالة MySQL
Get-Service | Where-Object {$_.Name -like "*mysql*"}

# تشغيل MySQL (إذا كان متوقفاً)
Start-Service MySQL80
# أو
Start-Service MySQL
```

### الحل 2: التحقق من إعدادات الاتصال

#### 1. افتح ملف `.env` في جذر المشروع
تأكد من وجود:
```env
DATABASE_URL="mysql://username:password@localhost:3306/database_name"
```

#### 2. استبدل القيم:
- `username`: اسم المستخدم (عادة `root`)
- `password`: كلمة المرور
- `database_name`: اسم قاعدة البيانات (مثلاً `aqqilha`)

#### مثال:
```env
DATABASE_URL="mysql://root:your_password@localhost:3306/aqqilha"
```

### الحل 3: إنشاء قاعدة البيانات

#### 1. افتح MySQL Command Line أو phpMyAdmin

#### 2. أنشئ قاعدة البيانات:
```sql
CREATE DATABASE aqqilha CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

#### 3. أو استخدم PowerShell:
```powershell
# الاتصال بـ MySQL وإنشاء قاعدة البيانات
mysql -u root -p -e "CREATE DATABASE IF NOT EXISTS aqqilha CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"
```

### الحل 4: تطبيق Schema قاعدة البيانات

بعد إنشاء قاعدة البيانات، طبق الـ Schema:

```powershell
# تطبيق Schema
npm run db:push

# أو إنشاء Migration
npm run db:migrate
```

### الحل 5: إعادة تشغيل Next.js

بعد إصلاح قاعدة البيانات:

```powershell
# إيقاف الخادم الحالي (Ctrl+C)
# ثم إعادة التشغيل
npm run dev
```

## التحقق من الاتصال

### اختبار الاتصال بـ MySQL:
```powershell
# اختبار الاتصال
mysql -u root -p -e "SHOW DATABASES;"
```

### أو استخدم Prisma Studio:
```powershell
npx prisma studio
```

## حلول إضافية

### إذا كان MySQL على منفذ مختلف:
غيّر `DATABASE_URL` في `.env`:
```env
DATABASE_URL="mysql://root:password@localhost:3307/aqqilha"
```

### إذا كنت تستخدم XAMPP:
- تأكد من تشغيل **Apache** و **MySQL** من لوحة التحكم
- المنفذ الافتراضي هو `3306`

### إذا كنت تستخدم Docker:
```powershell
# التحقق من الحاويات
docker ps

# تشغيل MySQL Container
docker-compose up -d mysql
```

## نصائح

1. **احفظ نسخة احتياطية** من `.env` قبل التعديل
2. **لا تشارك** ملف `.env` في Git (يجب أن يكون في `.gitignore`)
3. **استخدم كلمات مرور قوية** لقاعدة البيانات
4. **راقب السجلات** في MySQL للتحقق من الأخطاء

## روابط مفيدة

- [Prisma MySQL Setup](https://www.prisma.io/docs/concepts/database-connectors/mysql)
- [MySQL Documentation](https://dev.mysql.com/doc/)

