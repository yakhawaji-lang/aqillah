# دليل إضافة البيانات الواقعية للنظام

## نظرة عامة

تم إنشاء نظام شامل لإضافة بيانات واقعية تحاكي عمل البرنامج بشكل كامل، بما في ذلك:
- بيانات الازدحام المروري
- التنبؤات
- التنبيهات
- بيانات الطقس
- نقاط الازدحام
- القرارات المرورية
- الإحصائيات

## الاستخدام

### 1. إضافة البيانات الأولية

```bash
npm run db:seed:realistic
```

أو:

```bash
npx tsx scripts/generate-realistic-data.ts
```

هذا الأمر سيقوم بـ:
- إنشاء مقاطع الطرق الرئيسية في المدن السعودية (الرياض، جدة، الدمام)
- إضافة بيانات ازدحام لآخر 7 أيام
- إنشاء تنبؤات للـ 5، 10، 30، 60 دقيقة القادمة
- إضافة تنبيهات نشطة
- إضافة بيانات الطقس
- إنشاء نقاط ازدحام
- إضافة قرارات مرورية
- إنشاء إحصائيات الاستخدام

### 2. تحديث البيانات بشكل دوري

#### عبر API:

```bash
# تحديث جميع البيانات
curl -X POST http://localhost:3000/api/data/update

# تحديث بيانات الازدحام فقط
curl -X POST http://localhost:3000/api/data/update \
  -H "Content-Type: application/json" \
  -d '{"type": "traffic"}'

# تحديث التنبؤات فقط
curl -X POST http://localhost:3000/api/data/update \
  -H "Content-Type: application/json" \
  -d '{"type": "predictions"}'

# تحديث التنبيهات فقط
curl -X POST http://localhost:3000/api/data/update \
  -H "Content-Type: application/json" \
  -d '{"type": "alerts"}'

# تحديث بيانات الطقس فقط
curl -X POST http://localhost:3000/api/data/update \
  -H "Content-Type: application/json" \
  -d '{"type": "weather"}'
```

#### التحقق من حالة التحديث:

```bash
curl http://localhost:3000/api/data/update
```

### 3. إعداد تحديث تلقائي

يمكنك إعداد cron job أو scheduled task لتحديث البيانات كل 5-10 دقائق:

#### Windows (Task Scheduler):
```powershell
# إنشاء مهمة مجدولة
schtasks /create /tn "Aqillah Data Update" /tr "curl -X POST http://localhost:3000/api/data/update" /sc minute /mo 5
```

#### Linux/Mac (Cron):
```bash
# إضافة إلى crontab
*/5 * * * * curl -X POST http://localhost:3000/api/data/update
```

## البيانات المضافة

### 1. مقاطع الطرق

يتم إنشاء مقاطع للطرق الرئيسية في:
- **الرياض**: طريق الملك فهد، الدائري الشرقي/الغربي/الشمالي/الجنوبي، طريق الملك عبدالعزيز، وغيرها
- **جدة**: طريق الملك فهد، الكورنيش، الحرمين، وغيرها
- **الدمام**: طريق الملك فهد، الكورنيش، الخليج

### 2. بيانات الازدحام

- بيانات كل ساعة لآخر 7 أيام
- أنماط ازدحام واقعية حسب الوقت:
  - **الصباح (6-10)**: ازدحام عالي (40-85%)
  - **الظهر (10-14)**: ازدحام متوسط (20-50%)
  - **بعد الظهر (14-17)**: ازدحام متوسط (30-70%)
  - **المساء (17-21)**: ازدحام عالي جداً (50-95%)
  - **الليل (21-6)**: ازدحام منخفض (10-30%)

### 3. التنبؤات

- تنبؤات للـ 5، 10، 30، 60 دقيقة القادمة
- مستوى ثقة يتناقص مع الوقت
- عوامل مؤثرة (الوقت، التاريخ، الطقس)

### 4. التنبيهات

- تنبيهات نشطة (5-15 تنبيه)
- أنواع مختلفة: ازدحام، حادث، فعالية، طقس، صيانة
- مستويات خطورة: منخفض، متوسط، عالي، حرج
- مسارات بديلة مقترحة

### 5. بيانات الطقس

- بيانات للرياض، جدة، الدمام
- حالات مختلفة: صافي، غائم، ممطر، ضباب
- توقعات ساعية لـ 24 ساعة

### 6. نقاط الازدحام

- نقاط ازدحام في المقاطع المزدحمة
- معلومات عن نقطة الانطلاق والامتداد الخلفي
- حالة الحل

### 7. القرارات المرورية

- قرارات مقترحة: تحويل، تعديل إشارة، تدخل
- تأثير متوقع وتقييم الفائدة

## التخصيص

يمكنك تعديل السكريبت لتغيير:
- عدد الأيام من البيانات التاريخية
- عدد المقاطع المحدثة
- احتمالية إنشاء تنبيهات جديدة
- أنماط الازدحام

## ملاحظات

- البيانات محاكاة وليست بيانات حقيقية
- يتم توليد البيانات بشكل عشوائي بناءً على أنماط واقعية
- يمكن استخدام النظام للاختبار والتطوير
- في الإنتاج، سيتم استبدال البيانات المحاكاة ببيانات حقيقية من APIs

## استكشاف الأخطاء

### المشكلة: فشل في إنشاء البيانات
**الحل:**
- تأكد من تشغيل قاعدة البيانات
- تحقق من إعدادات DATABASE_URL في .env
- تأكد من تشغيل `npm run db:push` أولاً

### المشكلة: البيانات لا تظهر في الواجهة
**الحل:**
- تحقق من أن البيانات تم إنشاؤها في قاعدة البيانات
- افتح Prisma Studio: `npm run db:studio`
- تحقق من آخر تحديث: `curl http://localhost:3000/api/data/update`

### المشكلة: التحديثات التلقائية لا تعمل
**الحل:**
- تحقق من أن API endpoint يعمل
- تأكد من إعداد cron job أو scheduled task بشكل صحيح
- تحقق من سجلات الأخطاء

